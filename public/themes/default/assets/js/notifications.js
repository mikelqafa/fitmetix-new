var vue=new Vue({el:"#navbar-right",data:{notifications:[],unreadNotifications:0,notificationsLoaded:!1,notificationsLoading:!1,conversations:[],posts:[],unreadConversations:0,conversationsLoaded:!1,conversationsLoading:!1,pusher:[]},computed:{isShowUCM:function(){return this.unreadNotifications>0}},created:function(){$(".dropdown-messages-list").bind("scroll",this.chk_scroll),this.getNotificationsCounter(),this.getConversationsCounter(),this.subscribeToNotificationsChannel(),this.subscribeToMessagesChannel()},methods:{subscribeToNotificationsChannel:function(){var t=this;this.pusher=new Pusher(pusherConfig.PUSHER_KEY,{encrypted:!0,auth:{headers:{"X-CSRF-Token":pusherConfig.token},params:{username:"vijay"}}}),this.NotificationChannel=this.pusher.subscribe(current_username+"-notification-created"),this.NotificationChannel.bind("App\\Events\\NotificationPublished",function(i){t.unreadNotifications=t.unreadNotifications+1,i.notification.notified_from=i.notified_from,null!=t.notifications.data&&t.notifications.data.unshift(i.notification),t.notify(i.notification.description),$.playSound(theme_url+"/sounds/notification"),jQuery("time.timeago").timeago()})},subscribeToMessagesChannel:function(){var t=this;this.pusher=new Pusher(pusherConfig.PUSHER_KEY,{encrypted:!0,auth:{headers:{"X-CSRF-Token":pusherConfig.token},params:{username:"vijay"}}}),this.MessageChannel=this.pusher.subscribe(current_username+"-message-created"),this.MessageChannel.bind("App\\Events\\MessagePublished",function(i){t.unreadConversations=t.unreadConversations+1,t.conversationsLoaded&&t.conversations.data.unshift(i.message),t.notify(i.message.body),jQuery("time.timeago").timeago()})},getNotificationsCounter:function(){this.$http.post(base_url+"ajax/get-unread-notifications").then(function(t){this.unreadNotifications=JSON.parse(t.body).unread_notifications})},showNotifications:function(){this.notificationsLoaded||(this.notificationsLoading=!0,this.$http.post(base_url+"ajax/get-notifications").then(function(t){this.notifications=JSON.parse(t.body).notifications,setTimeout(function(){jQuery("time.timeago").timeago()},10),this.notificationsLoading=!1}),this.notificationsLoaded=!0)},getMoreNotifications:function(){this.notifications.data.length<this.notifications.total&&(this.notificationsLoading=!0,this.$http.post(this.notifications.next_page_url).then(function(t){var i=JSON.parse(t.body).notifications;this.notifications.last_page=i.last_page,this.notifications.next_page_url=i.next_page_url,this.notifications.per_page=i.per_page,this.notifications.prev_page_url=i.prev_page_url;var n=this;$.each(i.data,function(t,i){n.notifications.data.push(i)}),this.notificationsLoading=!1,setTimeout(function(){jQuery("time.timeago").timeago()},10)}))},markNotificationsRead:function(){this.$http.post(base_url+"ajax/mark-all-notifications").then(function(t){this.unreadNotifications=0;var i=this;$.map(this.notifications,function(t,n){i.notifications[n].seen=!0})})},getConversationsCounter:function(){this.$http.post(base_url+"ajax/get-unread-messages").then(function(t){this.unreadConversations=JSON.parse(t.body).unread_conversations})},showConversations:function(){this.conversationsLoaded||(this.conversationsLoading=!0,this.$http.post(base_url+"ajax/get-messages").then(function(t){this.conversations=JSON.parse(t.body).data,setTimeout(function(){jQuery("time.timeago").timeago()},10),this.conversationsLoaded=!0,this.conversationsLoading=!1}))},getMoreConversations:function(){this.conversationsLoading=!0,this.conversations.data.length<this.conversations.total&&this.$http.post(this.conversations.next_page_url).then(function(t){var i=JSON.parse(t.body).data;this.conversations.last_page=i.last_page,this.conversations.next_page_url=i.next_page_url,this.conversations.per_page=i.per_page,this.conversations.prev_page_url=i.prev_page_url;var n=this;$.each(i.data,function(t,i){n.conversations.data.push(i)}),this.conversationsLoaded=!0,this.conversationsLoading=!1,setTimeout(function(){jQuery("time.timeago").timeago()},10)})},chk_scroll:function(t){var i=$(t.currentTarget);i[0].scrollHeight-i.scrollTop()==i.outerHeight()&&("notifications"==i.data("type")?this.getMoreNotifications():this.getMoreConversations())},notify:function(t,i,n){noty({text:t,layout:"bottomLeft",type:"success",theme:"relax",timeout:1,animation:{open:"animated fadeIn",close:"animated fadeOut",easing:"swing",speed:500}})}}});